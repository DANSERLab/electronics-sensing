import controlP5.*;
import processing.sound.*;

int bands = 512;
float[] spectrum = new float[bands];

ControlP5 cp5;
MainPanel mainPanel;
MenuBar topMenu;
GraphBar[] tplotArray;

FFT fft_o;
Chart fftChart;

int numAFEs = 4, numChannels = 4;
int totalCh = numAFEs * numChannels;
int absoluteCount;
float calcVal;

class MainPanel {

  MainPanel(SenseUI wClass) {

    cp5 = new ControlP5(wClass);
    cp5.setAutoDraw(false);

    topMenu = new MenuBar();

    absoluteCount = 0;

    tplotArray = new GraphBar[numAFEs*numChannels];

    for (int i = 1; i < numAFEs+1; i++) {
      for (int j = 1; j < numChannels+1; j++) {
        tplotArray[absoluteCount] = new GraphBar(i, j, 100, 75+absoluteCount * 55, 400, 50, 1);
        absoluteCount++;
      }
    }

    fftChart = cp5.addChart("fftData")
      .setPosition(550, 100)
      .setSize(400, 500)
      .setRange(0, 10)
      .setView(Chart.AREA)
      .setStrokeWeight(1)
      .setColorBackground(color(150))
      .setLabel("")
      ;

    fftChart.addDataSet("fftStream");
    fftChart.setData("fftStream", spectrum);
    fftChart.setColors("fftStream", color(255));
  }


  void draw() {
    topMenu.draw();
    for (int i = 0; i < totalCh; i++) {
      calcVal = 0.5*(sin(float(frameCount)*0.100*float(i)));
      tplotArray[i].draw(calcVal);
    }
    fft_o.input(0.5*(sin(float(frameCount)*0.100);
    fft_o.analyze(spectrum);
    cp5.draw();
  }
}